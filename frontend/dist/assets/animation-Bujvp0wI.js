var _={},C={},S={},D;function O(){if(D)return S;D=1,Object.defineProperty(S,"__esModule",{value:!0}),S.loop=S.conditional=S.parse=void 0;var x=function c(f,d){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;if(Array.isArray(d))d.forEach(function(p){return c(f,p,s,v)});else if(typeof d=="function")d(f,s,v,c);else{var u=Object.keys(d)[0];Array.isArray(d[u])?(v[u]={},c(f,d[u],s,v[u])):v[u]=d[u](f,s,v,c)}return s};S.parse=x;var h=function(f,d){return function(s,v,u,p){d(s,v,u)&&p(s,f,v,u)}};S.conditional=h;var t=function(f,d){return function(s,v,u,p){for(var o=[],e=s.pos;d(s,v,u);){var r={};if(p(s,f,v,r),s.pos===e)break;e=s.pos,o.push(r)}return o}};return S.loop=t,S}var y={},M;function $(){if(M)return y;M=1,Object.defineProperty(y,"__esModule",{value:!0}),y.readBits=y.readArray=y.readUnsigned=y.readString=y.peekBytes=y.readBytes=y.peekByte=y.readByte=y.buildStream=void 0;var x=function(e){return{data:e,pos:0}};y.buildStream=x;var h=function(){return function(e){return e.data[e.pos++]}};y.readByte=h;var t=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};y.peekByte=t;var c=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};y.readBytes=c;var f=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};y.peekBytes=f;var d=function(e){return function(r){return Array.from(c(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};y.readString=d;var s=function(e){return function(r){var n=c(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};y.readUnsigned=s;var v=function(e,r){return function(n,a,i){for(var g=typeof r=="function"?r(n,a,i):r,l=c(e),m=new Array(g),B=0;B<g;B++)m[B]=l(n);return m}};y.readArray=v;var u=function(e,r,n){for(var a=0,i=0;i<n;i++)a+=e[r+i]&&Math.pow(2,n-i-1);return a},p=function(e){return function(r){for(var n=h()(r),a=new Array(8),i=0;i<8;i++)a[7-i]=!!(n&1<<i);return Object.keys(e).reduce(function(g,l){var m=e[l];return m.length?g[l]=u(a,m.index,m.length):g[l]=a[m.index],g},{})}};return y.readBits=p,y}var G;function E(){return G||(G=1,function(x){Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var h=O(),t=$(),c={blocks:function(r){for(var n=0,a=[],i=r.data.length,g=0,l=(0,t.readByte)()(r);l!==n&&l;l=(0,t.readByte)()(r)){if(r.pos+l>=i){var m=i-r.pos;a.push((0,t.readBytes)(m)(r)),g+=m;break}a.push((0,t.readBytes)(l)(r)),g+=l}for(var B=new Uint8Array(g),A=0,b=0;b<a.length;b++)B.set(a[b],A),A+=a[b].length;return B}},f=(0,h.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===249}),d=(0,h.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,h.conditional)({lct:(0,t.readArray)(3,function(e,r,n){return Math.pow(2,n.descriptor.lct.size+1)})},function(e,r,n){return n.descriptor.lct.exists}),{data:[{minCodeSize:(0,t.readByte)()},c]}]},function(e){return(0,t.peekByte)()(e)===44}),s=(0,h.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(r,n,a){return(0,t.readBytes)(a.text.blockSize)(r)}},c]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===1}),v=(0,h.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(r,n,a){return(0,t.readString)(a.blockSize)(r)}},c]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===255}),u=(0,h.conditional)({comment:[{codes:(0,t.readBytes)(2)},c]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===254}),p=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,h.conditional)({gct:(0,t.readArray)(3,function(e,r){return Math.pow(2,r.lsd.gct.size+1)})},function(e,r){return r.lsd.gct.exists}),{frames:(0,h.loop)([f,v,u,d,s],function(e){var r=(0,t.peekByte)()(e);return r===33||r===44})}],o=p;x.default=o}(C)),C}var I={},T;function K(){if(T)return I;T=1,Object.defineProperty(I,"__esModule",{value:!0}),I.deinterlace=void 0;var x=function(t,c){for(var f=new Array(t.length),d=t.length/c,s=function(n,a){var i=t.slice(a*c,(a+1)*c);f.splice.apply(f,[n*c,c].concat(i))},v=[0,4,2,1],u=[8,8,4,2],p=0,o=0;o<4;o++)for(var e=v[o];e<d;e+=u[o])s(e,p),p++;return f};return I.deinterlace=x,I}var P={},R;function X(){if(R)return P;R=1,Object.defineProperty(P,"__esModule",{value:!0}),P.lzw=void 0;var x=function(t,c,f){var d=4096,s=-1,v=f,u,p,o,e,r,n,a,z,i,g,U,l,k,w,q,F,m=new Array(f),B=new Array(d),A=new Array(d),b=new Array(d+1);for(l=t,p=1<<l,r=p+1,u=p+2,a=s,e=l+1,o=(1<<e)-1,i=0;i<p;i++)B[i]=0,A[i]=i;var U,z,k,w,F,q;for(U=z=k=w=F=q=0,g=0;g<v;){if(w===0){if(z<e){U+=c[q]<<z,z+=8,q++;continue}if(i=U&o,U>>=e,z-=e,i>u||i==r)break;if(i==p){e=l+1,o=(1<<e)-1,u=p+2,a=s;continue}if(a==s){b[w++]=A[i],a=i,k=i;continue}for(n=i,i==u&&(b[w++]=k,i=a);i>p;)b[w++]=A[i],i=B[i];k=A[i]&255,b[w++]=k,u<d&&(B[u]=a,A[u]=k,u++,(u&o)===0&&u<d&&(e++,o+=u)),a=n}w--,m[F++]=b[w],g++}for(g=F;g<v;g++)m[g]=0;return m};return P.lzw=x,P}var j;function Z(){if(j)return _;j=1,Object.defineProperty(_,"__esModule",{value:!0}),_.decompressFrames=_.decompressFrame=_.parseGIF=void 0;var x=d(E()),h=O(),t=$(),c=K(),f=X();function d(o){return o&&o.__esModule?o:{default:o}}var s=function(e){var r=new Uint8Array(e);return(0,h.parse)((0,t.buildStream)(r),x.default)};_.parseGIF=s;var v=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(r*4),a=0;a<r;a++){var i=a*4,g=e.pixels[a],l=e.colorTable[g]||[0,0,0];n[i]=l[0],n[i+1]=l[1],n[i+2]=l[2],n[i+3]=g!==e.transparentIndex?255:0}return n},u=function(e,r,n){if(!e.image){console.warn("gif frame does not have associated image.");return}var a=e.image,i=a.descriptor.width*a.descriptor.height,g=(0,f.lzw)(a.data.minCodeSize,a.data.blocks,i);a.descriptor.lct.interlaced&&(g=(0,c.deinterlace)(g,a.descriptor.width));var l={pixels:g,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return a.descriptor.lct&&a.descriptor.lct.exists?l.colorTable=a.lct:l.colorTable=r,e.gce&&(l.delay=(e.gce.delay||10)*10,l.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(l.transparentIndex=e.gce.transparentColorIndex)),n&&(l.patch=v(l)),l};_.decompressFrame=u;var p=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return u(n,e.gct,r)})};return _.decompressFrames=p,_}var L=Z();function H(x){const h=L.parseGIF(x),c=L.decompressFrames(h,!0).map(n=>({imageData:new ImageData(new Uint8ClampedArray(n.patch),n.dims.width,n.dims.height),delay:(n.delay||10)*10}));let f=!1,d=0,s=null;function v(){return f}function u(n){const a=c[d];n.putImageData(a.imageData,0,0)}function p(n,a=!0){if(!f)return;u(n);const i=c[d].delay;if(d=(d+1)%c.length,d===0&&!a){r();return}s=window.setTimeout(()=>p(n,a),i)}function o(n,a=!0){f||(f=!0,d=0,p(n,a))}function e(){f=!1,s!==null&&clearTimeout(s),s=null}function r(){e(),d=0}return{frames:c,isPlaying:v,play:o,pause:e,stop:r}}export{H as createGifAnimation};
