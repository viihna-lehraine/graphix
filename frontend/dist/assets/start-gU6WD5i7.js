import{_ as D}from"./index-CMuSpS8o.js";let x=null,y=!1,h={x:0,y:0},w=!1,v=null,C=0,I=32;function M(t){const{data:{dom:{ids:r}}}=t,e=document.getElementById(r.toggleAssetBrowserBtn),s=document.getElementById(r.assetBrowserDiv);if(!e)throw new Error("Asset Browser Toggle Button not found!");if(!s)throw new Error("Asset Browser Div not found!");e.addEventListener("click",()=>{s.classList.toggle("open")}),document.addEventListener("click",n=>{!s.contains(n.target)&&n.target!==e&&s.classList.remove("open")})}function z(t){const{data:{dom:{ids:r}},services:{cache:e,errors:s,log:n,stateManager:d}}=t;return s.handleSync(()=>{const i=r.clearBtn,o=document.getElementById(i);if(!o)throw new Error("Canvas Clear Button not found!");o.addEventListener("click",()=>{if(d.clearCanvasAll(),d.setCanvasImage(void 0),d.setCanvasAspectRatio(void 0),d.clearCanvasAnimation(),e.cachedBgImg=null,!document.getElementById(r.canvas))throw new Error("Canvas element not found in DOM!");d.clearCanvasAll(),n.info("Canvas cleared and reset via StateManager.","initializeCanvasClearButton")}),n.debug("Clear Button listener successfully attached.")},"Unhandled Canvas Clear Button initialization error.")}function b(t,r){const{data:{dom:{ids:e},config:{defaults:s}},helpers:n,services:{errors:d,log:i,stateManager:o}}=t;return d.handleSync(()=>{const c=e.downloadBtn,g=document.getElementById(c);if(!g)throw new Error("Download button not found!");g.addEventListener("click",()=>{const u=document.getElementById(e.canvas);if(!u)throw new Error("Canvas element not found in DOM!");if(!n.canvas.get2DContext(u))throw new Error("Canvas 2D context not available.");const a=o.getCanvas(),l=a.layers.some(L=>L.type==="gif"),f=u.width,E=u.height,p=s.animation.frameCount,B=s.fileName||"default.png";l?(i.info("AnimationLayer(s) detected - running GIF export pipeline..."),r.exportGif(a.layers,f,E,p,t,B)):(i.info("Running static image export pipeline..."),r.exportStaticFile(a.layers,f,E,t,B))}),i.debug("Download Button listener successfully attached.")},"Unhandled Download Button initialization error.")}function A(t){const{data:{dom:{ids:r}},services:{errors:e,stateManager:s}}=t;return e.handleSync(()=>{const n=document.getElementById(r.textForm),d=document.getElementById(r.textInput);if(!n)throw new Error("Text form not found in DOM.");if(!d)throw new Error("Text input not found in DOM.");const i=document.getElementById(r.canvas);if(!i)throw new Error("Canvas element not found in DOM!");n.addEventListener("submit",o=>{o.preventDefault();const c=d.value.trim();c&&(s.addTextElement({text:c,x:i.width/2,y:i.height/2,font:"bold 32px sans-serif",fontSize:32,color:"#000000",align:"center",baseline:"middle"}),d.value="")})},"Unhandled Text Input Form initialization error.")}async function S(t,r){const{data:{dom:{ids:e}},services:s}=t,{errors:n}=s,{createGifAnimation:d}=await D(async()=>{const{createGifAnimation:i}=await import("./animation-Bujvp0wI.js");return{createGifAnimation:i}},[]);return n.handleAsync(async()=>{const i=document.getElementById(e.uploadBtn),o=document.getElementById(e.imgUploadInput);if(!i)throw new Error("Upload button not found.");if(!o)throw new Error("Image upload input not found.");i.addEventListener("click",()=>o.click()),o.addEventListener("change",()=>{const c=o.files?.[0];c&&r.handleUpload(c,t,d)})},"Failed to initialize upload UI.")}function T(t,r,e,s){const{helpers:n,services:d}=e,{errors:i,stateManager:o}=d;return i.handleSync(()=>{t.addEventListener("mousedown",c=>{y=!1,w=!1,x=null,v=null;const g=o.getState(),u=n.canvas.getMousePosition(t,c),m=t.getContext("2d"),a=g.canvas.layers.find(l=>l.type==="text");if(a)for(let l=a.textElements.length-1;l>=0;l--){const f=a.textElements[l];if(n.canvas.isOverResizeHandle(u,f,m)){w=!0,v=l,C=u.y,I=f.fontSize??32,o.setSelectedLayerIndex(l);return}if(n.canvas.isPointInText(u,f,m)){x=l,y=!0,h.x=u.x-f.x,h.y=u.y-f.y,o.setSelectedLayerIndex(l);break}}}),t.addEventListener("mousemove",c=>{const g=t.getContext("2d"),m=o.getCanvas().layers.find(a=>a.type==="text");if(m){if(w&&v!==null){const a=m.textElements[v],f=n.canvas.getMousePosition(t,c).y-C,E=Math.max(10,I+f),p={...a,fontSize:E};m.textElements[v]=p,s.redraw(g,o.getCanvas());return}if(y&&x!==null){const a=m.textElements[x],l=n.canvas.getMousePosition(t,c),f={...a,x:l.x-h.x,y:l.y-h.y};m.textElements[x]=f,s.redraw(g,o.getCanvas())}}}),t.addEventListener("mouseup",()=>{y=!1,w=!1,v=null}),t.addEventListener("mouseleave",()=>{y=!1,w=!1,v=null}),t.addEventListener("dblclick",c=>{const g=o.getCanvas(),u=n.canvas.getMousePosition(t,c),m=g.layers.find(a=>a.type==="text");if(m)for(let a=m.textElements.length-1;a>=0;a--){const l=m.textElements[a];if(n.canvas.isPointInText(u,l,t.getContext("2d"))){r.showTxtElemOverlay(t,l,a,e,()=>s.redraw(t.getContext("2d"),o.getCanvas()));break}}})},"Unhandled text drag handlers initialization error.")}async function O(t,r,e,s){const{data:{dom:{ids:n}},services:{errors:d}}=e,i=document.getElementById(n.canvas);if(!i)throw new Error("Canvas element not found in DOM!");return d.handleAsync(async()=>{M(e),z(e),b(e,t),await S(e,t),A(e),T(i,r,e,s)},"Canvas UI initialization failed.")}export{O as initializeCanvasUI};
